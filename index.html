<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Tank Game!</title>
  <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
  <style>
    html, body {
      margin: 0;
      padding: 0;
      width: 100vw;
      height: 100vh;
      overflow: hidden;
      background: #23272e;
    }
    .title {
      text-align: center;
      margin-top: 0;
      padding-top: 20px;
      background: linear-gradient(90deg, #000 20%, #4e9af1 50%, #fff 80%);
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
      font-family: 'Press Start 2P', cursive;
      font-size: 2.5rem;
      letter-spacing: 2px;
      text-shadow: 0 2px 8px #0008;
    }
    button {
      display: block;
      margin: 20px auto;
      padding: 10px 20px;
      font-size: 16px;
      background-color: #000000;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-family: 'Press Start 2P', cursive;
      text-transform: uppercase;
      letter-spacing: 1px;
      box-shadow: 0 2px 8px #0005;
      transition: background 0.2s;
    }
    button:hover {
      background: #222;
    }
    .game-container {
      position: relative;
      width: 100vw;
      height: 100vh;
      overflow: hidden;
      background: #23272e;
    }
    .game-bg {
      position: absolute;
      left: 0; top: 0;
      width: 100vw;
      height: 100vh;
      object-fit: contain;
      object-position: center center;
      z-index: 0;
      opacity: 0.95;
      filter: blur(0.5px) brightness(1.05);
      pointer-events: none;
    }
    #player1, #player2 {
      width: 100px;
      height: 100px;
      position: absolute;
      transition: left 0.08s linear, top 0.08s linear, transform 0.12s cubic-bezier(.4,2,.6,1);
      filter: drop-shadow(0 6px 12px rgba(0,0,0,0.3));
      will-change: left, top, transform;
      z-index: 2;
    }
    .bullet {
      width: 14px;
      height: 14px;
      background: radial-gradient(circle at 40% 40%, #eee 70%, #888 100%);
      position: absolute;
      border-radius: 50%;
      box-shadow: 0 2px 8px #0007;
      z-index: 3;
      pointer-events: none;
      transition: left 0.04s linear, top 0.04s linear;
    }
    .health-bar {
      position: absolute;
      width: 60px;
      height: 10px;
      background: #333;
      border: 2px solid #111;
      border-radius: 6px;
      top: 0;
      left: 0;
      z-index: 10;
      overflow: hidden;
    }
    .health-inner {
      height: 100%;
      background: linear-gradient(90deg, #4caf50, #a2ff4d);
      width: 100%;
      transition: width 0.2s;
    }
    /* Removed .revive-cross, not needed anymore */
  </style>
</head>
<body>
  <h1 class="title" id="gameTitle">Tankgame!</h1>
  <button id="startBtn" onclick="startGame()">Start the tank game</button>
  <p id="controlsText" style="
    color: red;
    text-align: center;
    font-family: 'Press Start 2P', cursive;
    margin-top: 10px;
    margin-bottom: 0;
  ">
    Player 1: Arrow Keys + Mouse Click to shoot<br>
    Player 2: WASD + Spacebar to shoot
  </p>
  <div id="gameRoot"></div>
  <script>
    function startGame() {
      // Ask for player name
      const playerName = prompt("Enter your name:");
      if (!playerName) return; // Cancel if no name entered

      // Hide the title and button
      document.getElementById('gameTitle').style.display = 'none';
      document.getElementById('startBtn').style.display = 'none';
        
      document.getElementById('gameRoot').innerHTML = `
      <div class="game-container" id="gameContainer">
        <img src="sr5z2ff1002c5caws3.png" alt="Game Screen" class="game-bg">
        <img src="old.png" alt="Old" id="oldImg" style="position:absolute; left:50%; top:50%; width:200px; z-index:5; transform:translate(-50%,-50%);">
        <div id="oldTankSpeech" style="
          position: absolute;
          left: 50%;
          top: 70%;
          transform: translate(-50%, 0);
          background: rgba(30,30,30,0.92);
          color: #fff;
          font-family: 'Press Start 2P', cursive;
          font-size: 13px;
          padding: 18px 22px 40px 22px;
          border-radius: 12px;
          border: 2px solid #222;
          z-index: 10;
          width: 480px;
          text-align: center;
          box-shadow: 0 4px 24px #000a;
        ">
          Hello ${playerName}, you must have been sent here by The Nova Armor Alliance or the N.A.A.<br>
          Well, I'm the old tank. I'm just here to tell you good luck, so good luck!
          <br>
          <button id="okOldTank" style="
            margin-top: 18px;
            font-size: 14px;
            padding: 8px 24px;
            border-radius: 8px;
            border: none;
            background: #4e9af1;
            color: #fff;
            font-family: 'Press Start 2P', cursive;
            cursor: pointer;
            box-shadow: 0 2px 8px #0005;
          ">OK</button>
        </div>
        <img src="firts.png" alt="Game Screen" class="game-bg">
        <div class="health-bar" id="healthBar1"><div class="health-inner" id="healthInner1"></div></div>
        <img id="player1" src="p1.png" alt="Player 1">
        <div class="health-bar" id="healthBar2"><div class="health-inner" id="healthInner2"></div></div>
        <img id="player2" src="pixil-frame-0 (1).png" alt="Player 2">
      </div>
    `;

      // Add this after setting innerHTML:
      setTimeout(() => {
        const okBtn = document.getElementById('okOldTank');
        if (okBtn) {
          okBtn.onclick = function() {
            const speech = document.getElementById('oldTankSpeech');
            if (speech) {
              speech.style.display = 'none';
            }
            const oldImg = document.getElementById('oldImg');
            if (oldImg) {
              oldImg.style.display = 'none';
            }
          };
        }
      }, 0);

      const gameContainer = document.getElementById('gameContainer');
      const player1 = document.getElementById('player1');
      const player2 = document.getElementById('player2');
      const healthBar1 = document.getElementById('healthBar1');
      const healthBar2 = document.getElementById('healthBar2');
      const healthInner1 = document.getElementById('healthInner1');
      const healthInner2 = document.getElementById('healthInner2');

      let x1 = 850, y1 = 750, rotation1 = 0, health1 = 100, dead1 = false;
      let x2 = 750, y2 = 750, rotation2 = 0, health2 = 100, dead2 = false;

      const step = 5;
      const keys = {};
      const bullets = [];
      let respawnTimeout1 = null;
      let respawnTimeout2 = null;
      let canShoot2 = true;
      let onFirstScreen = true; // Track which screen we're on

      player1.style.left = x1 + 'px';
      player1.style.top = y1 + 'px';
      player2.style.left = x2 + 'px';
      player2.style.top = y2 + 'px';

      document.addEventListener('keydown', (event) => {
        keys[event.key] = true;
        // Only fire once per key press for player 2 (spacebar)
        if (event.key === ' ' && !dead2 && canShoot2) {
          shootBullet(x2, y2, rotation2, 'p2');
          canShoot2 = false;
        }
      });
      document.addEventListener('keyup', (event) => {
        keys[event.key] = false;
        // Allow shooting again when spacebar is released
        if (event.key === ' ') {
          canShoot2 = true;
        }
      });

      // Prevent blue highlight and default behavior on click
      gameContainer.addEventListener('mousedown', (e) => {
        e.preventDefault();
        if (!dead1) shootBullet(x1, y1, rotation1, 'p1');
      });

      function shootBullet(x, y, rotation, player) {
        const bullet = document.createElement('div');
        bullet.className = 'bullet';
        bullet.setAttribute('data-owner', player);
        bullet.style.left = `${x + 43}px`;
        bullet.style.top = `${y + 43}px`;
        gameContainer.appendChild(bullet);

        let angle;
        if (player === 'p1') {
          angle = (rotation - 90 + 180) * (Math.PI / 180);
        } else {
          angle = (rotation - 90) * (Math.PI / 180);
        }
        const speed = 13;
        let bulletX = x + 50;
        let bulletY = y + 50;

        bullets.push({el: bullet, x: bulletX, y: bulletY, angle, speed, owner: player});
      }

      function rectsOverlap(ax, ay, aw, ah, bx, by, bw, bh) {
        return ax < bx + bw && ax + aw > bx && ay < by + bh && ay + ah > by;
      }

      function switchToNextScreen() {
        // Change background to sr5z2ff1002c5caws3.png
        document.querySelector('.game-bg').src = 'sr5z2ff1002c5caws3.png';
        // Add old.png in the center if not already present
        if (!document.getElementById('oldImg')) {
          const oldImg = document.createElement('img');
          oldImg.src = 'old.png';
          oldImg.alt = 'Old';
          oldImg.id = 'oldImg';
          oldImg.style.position = 'absolute';
          oldImg.style.left = '50%';
          oldImg.style.top = '50%';
          oldImg.style.width = '200px';
          oldImg.style.zIndex = '5';
          oldImg.style.transform = 'translate(-50%,-50%)';
          document.getElementById('gameContainer').appendChild(oldImg);
        }
        // Move both tanks to bottom of the screen
        y1 = window.innerHeight - 120;
        y2 = window.innerHeight - 120;
        player1.style.left = x1 + 'px';
        player1.style.top = y1 + 'px';
        player2.style.left = x2 + 'px';
        player2.style.top = y2 + 'px';
        onFirstScreen = false;
      }

      function update() {
        if (!dead1) {
          if (keys['ArrowUp']) {
            y1 -= step;
            rotation1 = -180;
          }
          if (keys['ArrowDown']) {
            y1 += step;
            rotation1 = 0;
          }
          if (keys['ArrowLeft']) {
            x1 -= step;
            rotation1 = -270;
          }
          if (keys['ArrowRight']) {
            x1 += step;
            rotation1 = 270;
          }
        }
        if (!dead2) {
          if (keys['w']) {
            y2 -= step;
            rotation2 = 0;
          }
          if (keys['s']) {
            y2 += step;
            rotation2 = 180;
          }
          if (keys['a']) {
            x2 -= step;
            rotation2 = 270;
          }
          if (keys['d']) {
            x2 += step;
            rotation2 = -270;
          }
        }

        // --- SCREEN TRANSITION LOGIC ---
        if (onFirstScreen && (y1 <= 0 || y2 <= 0)) {
          switchToNextScreen();
        }

        x1 = Math.max(0, Math.min(window.innerWidth - 100, x1));
        y1 = Math.max(0, Math.min(window.innerHeight - 100, y1));
        x2 = Math.max(0, Math.min(window.innerWidth - 100, x2));
        y2 = Math.max(0, Math.min(window.innerHeight - 100, y2));

        player1.style.left = x1 + 'px';
        player1.style.top = y1 + 'px';
        player1.style.transform = `rotate(${rotation1}deg)`;
        player1.style.display = dead1 ? 'none' : '';

        player2.style.left = x2 + 'px';
        player2.style.top = y2 + 'px';
        player2.style.transform = `rotate(${rotation2}deg)`;
        player2.style.display = dead2 ? 'none' : '';

        healthBar1.style.left = (x1 + 20) + 'px';
        healthBar1.style.top = (y1 - 18) + 'px';
        healthInner1.style.width = Math.max(0, health1) + '%';
        healthBar1.style.display = dead1 ? 'none' : '';

        healthBar2.style.left = (x2 + 20) + 'px';
        healthBar2.style.top = (y2 - 18) + 'px';
        healthInner2.style.width = Math.max(0, health2) + '%';
        healthBar2.style.display = dead2 ? 'none' : '';

        // --- Bullets now do NOT hurt tanks ---
        for (let i = bullets.length - 1; i >= 0; i--) {
          const b = bullets[i];
          b.x += Math.cos(b.angle) * b.speed;
          b.y += Math.sin(b.angle) * b.speed;
          b.el.style.left = `${b.x}px`;
          b.el.style.top = `${b.y}px`;

          // Only remove bullets if they go off screen
          if (
            b.x < -20 || b.x > window.innerWidth + 20 ||
            b.y < -20 || b.y > window.innerHeight + 20
          ) {
            b.el.remove();
            bullets.splice(i, 1);
          }
        }

        // --- Restart to start menu if both tanks are dead ---
        if (dead1 && dead2) {
          document.getElementById('gameRoot').innerHTML = '';
          document.getElementById('gameTitle').style.display = '';
          document.getElementById('startBtn').style.display = '';
          return;
        }

        requestAnimationFrame(update);
      }
      update();
    }
  </script>
</body>
</html>